# 计算机系统结构 作业5

计54 马子轩

## 题目

有一个 4-way 组相连 Cache，Cache 大小为 16K 字节（4K 字），Cache 块大小为 16 字节，执行以下程序：

```cpp
int M[4096], i, j;
for (i = 0; i < 10; i ++) {
	for (j = 0; j < 4096; j ++) {
		M[j] = i + j;
	}
}
```

1. 若 Cache 采用写分配（Write allocate）策略，计算执行整个程序时的 Cache 缺失率
2. 若 Cache 采用写不分配（No-write allocate）策略，计算执行整个程序时的 Cache 缺失率
3. 针对写不分配的 Cache 缺失率高的问题，试对程序进行优化，以取得最小的 Cache 缺失率。给出优化后的程序代码，并计算优化后的 Cache 缺失率

## 解答

### 1

采用写分配策略时，4096 * 4B = 16K

因此所有内容全部可以装入cache

此时缺失次数: 16kB/16B = 1024次

总次数: 4096 * 10 = 40960次

缺失率: 2.5%

### 2

采用写不分配时，写不填入cache。永远缺失。缺失率100%。

### 3

在写前读入，把数据加入cache即可。

```cpp
int M[4096], tmp, i, j;
for (i = 0; i < 4096; i++) {
	tmp = M[i];
}
for (i = 0; i < 10; i ++) {
	for (j = 0; j < 4096; j ++) {
		M[j] = i + j;
	}
}
```

针对写这一部分，cache缺失率0%

针对整体：cache缺失1024次，总次数40960 + 4096 = 45056

缺失次数不变，但是总访存次数提高了。

缺失率: 2.27%

整体来看效率降低了。
